

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ERVsearch &mdash; ERVsearch 1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Parameters" href="parameters.html" />
    <link rel="prev" title="ERVsearch Documentation" href="../index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> ERVsearch
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">ERVsearch</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#quick-start">Quick Start</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pipeline-description">Pipeline Description</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#screen">Screen</a></li>
<li class="toctree-l3"><a class="reference internal" href="#classify">Classify</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ervregions">ERVRegions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#input-files">Input Files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#required-input-files">Required Input Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#optional-input-files">Optional Input Files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#custom-databases">Custom Databases</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sequence-list">Sequence List</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#running-the-pipeline">Running the Pipeline</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parallelisation">Parallelisation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="parameters.html">Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="functions.html">Functions</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ERVsearch</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>ERVsearch</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/pages/introduction.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ervsearch">
<h1>ERVsearch<a class="headerlink" href="#ervsearch" title="Permalink to this headline">¶</a></h1>
<p>ERVsearch is a pipeline for identification of endogenous retrovirus like regions in a host genome, based on sequence similarity to known retroviruses.</p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>ERVsearch screens for endogenous retrovirus (ERV) like regions in any FASTA file using the Exonerate algorithm (Slater and Birney, 2005, doi 10.1186/1471-2105-6-31).</p>
<ul class="simple">
<li><p>In the <strong>Screen</strong> section, open reading frames (ORFs) resembling retroviral <em>gag</em>, <em>pol</em> and <em>env</em> genes are identified based on their level of similarity to a database of known complete or partial retroviral ORFs.</p></li>
<li><p>In the <strong>Classify</strong> section, these ORFs are classified into groups based on a database of currently classified retroviruses.</p></li>
<li><p>In the <strong>ERVRegions</strong> section, regions with ORFs resembling more than one retroviral gene are identified.</p></li>
</ul>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>The pipeline is currently available for Unix-based systems only.</p>
<p>The ERVsearch pipeline requires the following freely available software. All packages are available via pip and easy_install</p>
<p>Python 3.5+ with the following packages:</p>
<ul class="simple">
<li><p>ruffus - https://pypi.python.org/pypi/ruffus</p></li>
<li><p>numpy - https://pypi.python.org/pypi/numpy</p></li>
<li><p>pandas - https://pypi.python.org/pypi/pandas</p></li>
<li><p>ete3 - https://pypi.python.org/pypi/ete3</p></li>
<li><p>matplotlib - https://pypi.python.org/pypi/matplotlib</p></li>
</ul>
<p>The following commonly used software needs to be installed and in your $PATH</p>
<ul class="simple">
<li><p>Samtools: https://sourceforge.net/projects/samtools/files/</p></li>
<li><p>Bedtools: https://github.com/arq5x/bedtools2</p></li>
<li><p>Emboss: http://emboss.sourceforge.net/download/#Stable/</p></li>
<li><p>Mafft: http://mafft.cbrc.jp/alignment/software/linux.html</p></li>
<li><p>FastTree: http://meta.microbesonline.org/fasttree/#Install</p></li>
</ul>
<p>The following software also needs to be installed</p>
<ul class="simple">
<li><p>Exonerate: http://www.ebi.ac.uk/about/vertebrate-genomics/software/exonerate</p></li>
<li><p>Usearch: http://www.drive5.com/usearch/download.html</p></li>
</ul>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>The latest release of ERVsearch is available via pip3.
<code class="docutils literal notranslate"><span class="pre">pip3</span> <span class="pre">install</span> <span class="pre">ERVsearch</span></code></p>
<p>Alternatively, if you prefer to install directly,  the latest release can be downloaded from Github.
https://github.com/KatyBrown/ERVsearch/releases/latest</p>
<p>The latest (beta) version can also be cloned from github
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/KatyBrown/ERVsearch.git</span></code></p>
<p>No compliation is required, just add the ERVsearch directory to your path or use the full path to ERVsearch/ERVsearch. If installed using pip you should be able to call <code class="docutils literal notranslate"><span class="pre">ERVsearch</span></code> directly.</p>
</div>
<div class="section" id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h2>
<p>After cloning the repository, the program can be used as is (with the above prerequisites installed).</p>
<ol class="simple">
<li><p>Make a copy of the pipeline.ini file (templates/pipeline.ini) in your working directory (the directory in which would would like to store the output).</p></li>
<li><p>Download a local copy of your genome (or other sequence) of interest as a single FASTA file.</p></li>
<li><p>Edit your copy of pipeline.ini to configure the pipeline for your computer:</p>
<ul class="simple">
<li><p>Add the path to the genome you want to screen (the fasta file in step 2) to the genome section
e.g. hg38.fa saved in /home/myname/genome/hg38.fa would require the following options:
<code class="docutils literal notranslate"><span class="pre">[genome]</span></code>
<code class="docutils literal notranslate"><span class="pre">file_=/home/myname/genome/hg38.fa</span></code></p></li>
<li><p>Add the paths to ERVsearch, usearch and exonerate to the paths section
e.g.
<code class="docutils literal notranslate"><span class="pre">[paths]</span></code>
<code class="docutils literal notranslate"><span class="pre">path_to_ERVsearch=/home/myname/ERVsearch</span></code>
<code class="docutils literal notranslate"><span class="pre">path_to_usearch=/home/myname/usearch/usearch11.0.667_i86linux32</span></code>
<code class="docutils literal notranslate"><span class="pre">path_to_exonerate=/home/myname/exonerate/bin/exonerate</span></code></p></li>
<li><p>Run the pipeline in your working directory as:
<code class="docutils literal notranslate"><span class="pre">ERVsearch</span> <span class="pre">--target_tasks</span> <span class="pre">full</span> <span class="pre">-v5</span></code></p></li>
</ul>
</li>
</ol>
</div>
<div class="section" id="pipeline-description">
<h2>Pipeline Description<a class="headerlink" href="#pipeline-description" title="Permalink to this headline">¶</a></h2>
<p>The pipeline is designed to identify regions resembling retroviral <em>gag</em>, <em>pol</em> and <em>env</em> genes in a genome (or other set of sequences and to perform various analyses on these regions.</p>
<p>It is divided into three sections:</p>
<div class="section" id="screen">
<h3>Screen<a class="headerlink" href="#screen" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Screens the genome for ERV like regions by comparing the genome to a set of known retroviral ORFs using Exonerate.</p></li>
<li><p>Confirms the Exonerate regions using UBLAST</p></li>
<li><p>Finds and confirms ORFs within these regions</p></li>
<li><p>Finds the most similar known retroviral ORF in the database to each of the newly identified ORFs<br>
<a class="reference external" href="screen.html">Screen Functions</a></p></li>
</ul>
</div>
<div class="section" id="classify">
<h3>Classify<a class="headerlink" href="#classify" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Classifies the newly identified ORFs into groups based on the most similar known ORF</p></li>
<li><p>Aligns the newly identified ORFs with reference sequences within these groups and builds a phylogenetic tree for each group.</p></li>
<li><p>Finds clusters of newly identified ORFs within these trees</p></li>
<li><p>Incorporates representative sequences from these clusters into a summary tree for each retroviral gene and genus  (based on classification into <em>gamma</em>, <em>beta</em>, <em>spuma</em>, <em>alpha</em>, <em>lenti</em>, <em>epsilon</em> and <em>delta</em> retroviruses as definied by the ICTV (https://talk.ictvonline.org/taxonomy).<br>
<a class="reference external" href="classify.html">Classify Functions</a></p></li>
</ul>
</div>
<div class="section" id="ervregions">
<h3>ERVRegions<a class="headerlink" href="#ervregions" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Identifies regions of the genome containing ORFs resembling more than one different retroviral gene within a certain distance<br>
<a class="reference external" href="ERVregions.html">ERVRegions Functions</a></p></li>
</ul>
</div>
</div>
<div class="section" id="input-files">
<h2>Input Files<a class="headerlink" href="#input-files" title="Permalink to this headline">¶</a></h2>
<div class="section" id="required-input-files">
<h3>Required Input Files<a class="headerlink" href="#required-input-files" title="Permalink to this headline">¶</a></h3>
<p>1: <em>FASTA file to screen for ERVs</em></p>
<p>The main input file is sequence file in FASTA format (https://en.wikipedia.org/wiki/FASTA_format) containing DNA sequences from the genome of interest which you wish to screen for ERV-like regions. This would usually be a reference or de novo assembled genome but can be any set of DNA sequences.</p>
<p>Reference genome sequences are available from http://www.ensembl.org/info/about/species.html and https://genome-euro.ucsc.edu/index.html (amongst others).</p>
<p>To be used as an input file, the reference genome needs to be contained in a single FASTA file.</p>
<p>For Ensembl genomes, this would usually be the<code class="docutils literal notranslate"><span class="pre">GENOMEID.dna.toplevel.fa.gz</span></code>file from the “download DNA sequence” page for the appropriate organism, substituting <code class="docutils literal notranslate"><span class="pre">GENOMEID</span></code> for the genome ID (e.g. GRCh38)</p>
<p>For UCSC genomes this would be <code class="docutils literal notranslate"><span class="pre">GENOMEID.fa.gz</span></code> from the bigZips directory for this organism on the FTP server, substituting <code class="docutils literal notranslate"><span class="pre">GENOMEID</span></code> for the genome ID (e.g. hg38)</p>
<p>It is possible to use a gzipped or zipped file, in which case the filename needs to end with .gz or .zip respectively.</p>
<p>2: <code class="docutils literal notranslate"><span class="pre">pipeline.ini</span></code> file</p>
<p>This file is a configuration file in <code class="docutils literal notranslate"><span class="pre">ini</span></code> format (https://en.wikipedia.org/wiki/INI_file) containing the parmeters you wish to use.
This file needs to be in your working directory - the folder in which you wish to run ERVsearch.</p>
<p>A template <code class="docutils literal notranslate"><span class="pre">pipeline.ini</span></code> file should be used and edited - this file is available as templates/pipeline.ini.</p>
<p>Options specified as <code class="docutils literal notranslate"><span class="pre">!?</span></code> are required, all others have a default value.</p>
<p>Required parameters are as follows:</p>
<p>|Section|Parameter|Description|Example|
|-|-|-|-|
|<code class="docutils literal notranslate"><span class="pre">genome</span></code>|<code class="docutils literal notranslate"><span class="pre">file</span></code>|path to genome to screen|<code class="docutils literal notranslate"><span class="pre">/home/katy/ERVsearch_screen/mygenome.fasta</span></code>|
|<code class="docutils literal notranslate"><span class="pre">paths</span></code>|<code class="docutils literal notranslate"><span class="pre">path_to_ERVsearch</span></code>| path to the main ERVsearch folder on your computer|<code class="docutils literal notranslate"><span class="pre">/home/katy/ERVsearch</span></code>|
|<code class="docutils literal notranslate"><span class="pre">paths</span></code>|<code class="docutils literal notranslate"><span class="pre">path_to_exonerate</span></code>|path to the exonerate executable on your computer|<code class="docutils literal notranslate"><span class="pre">/home/katy/Exonerate2.4.0/bin/exonerate</span> <span class="pre">|</span></code>paths<code class="docutils literal notranslate"><span class="pre">|</span></code>path_to_usearch<code class="docutils literal notranslate"><span class="pre">|path</span> <span class="pre">to</span> <span class="pre">the</span> <span class="pre">USEARCH</span> <span class="pre">executable</span> <span class="pre">on</span> <span class="pre">your</span> <span class="pre">computer|</span> </code>/home/katy/USEARCH/usearch`|</p>
<p>Optional parameters are listed in the <strong>Parameters</strong> section below.</p>
</div>
<div class="section" id="optional-input-files">
<h3>Optional Input Files<a class="headerlink" href="#optional-input-files" title="Permalink to this headline">¶</a></h3>
<div class="section" id="custom-databases">
<h4>Custom Databases<a class="headerlink" href="#custom-databases" title="Permalink to this headline">¶</a></h4>
<p>By default, ERVsearch will use the provided database of 774 ERV nucleotide sequences and corresponding amino acid sequences as a query against the provided genome. This database is designed to be representative of known retroviruses and to identify the majority of ERVs. However, a more specific custom database can also be provided and used for the initial screen.</p>
<p>To do this, the database_use_custom_db parameter in the pipeline.ini can be set to True. The query sequences should be stored as FASTA files of amino acid sequences, with one file per retroviral gene. Only gag, pol and env genes are currently supported. Very short sequences (less than ~100 amino acids) should be avoided where possible.
The paths to these files are then specified in the database section of the pipeline.ini</p>
<p>e.g.</p>
<p><code class="docutils literal notranslate"><span class="pre">[database]</span></code>
<code class="docutils literal notranslate"><span class="pre">use_custom_db=True</span></code>
<code class="docutils literal notranslate"><span class="pre">gag=/home/katy/my_databases/gag_ervs.fasta</span></code>
<code class="docutils literal notranslate"><span class="pre">pol=/home/katy/my_databases/pol_ervs.fasta</span></code>
<code class="docutils literal notranslate"><span class="pre">env=/home/katy/my_databases/env_ervs.fasta</span></code></p>
<p>Currently, custom databases are only used for the initial Exonerate screen and UBLAST check, after this all classification based steps will use the default databases, as these sequences have been classified into subgroups for phylogenetic analysis.</p>
</div>
<div class="section" id="sequence-list">
<h4>Sequence List<a class="headerlink" href="#sequence-list" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">keep_chroms.txt</span></code></p>
<p>A list of chromosome names to include. The names should the names in the fasta file cropped at the first space,  e.g. “NW_006711271.1 Panthera tigris altaica isolate TaeGuk unplaced genomic scaffold” should just be listed as NW_006711271.1. The names should be listed with one name per line, are case sensitive and need to be identical to those in the fasta file. This file needs to be named keep_chroms.txt and in the working directory.</p>
</div>
</div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="section" id="running-the-pipeline">
<h3>Running the Pipeline<a class="headerlink" href="#running-the-pipeline" title="Permalink to this headline">¶</a></h3>
<p>The pipeline is implemented using the pipeline development package ruffus (http://www.ruffus.org.uk/, Goodstadt doi:2010 10.1093/bioinformatics/btq524).</p>
<p>To run the full pipeline, the following command is used:
<code class="docutils literal notranslate"><span class="pre">ERVsearch</span> <span class="pre">--target_tasks</span> <span class="pre">full</span></code></p>
<p>If the pipeline stops or fails at any point, it will restart from after the previous fully completed step (based on the presence of the output files from this step).</p>
<p>Sections of the pipeline can be run as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ERVsearch</span> <span class="pre">--target_tasks</span> <span class="pre">Screen</span></code> - screen with Exonerate and check the results with UBLAST, find ORFs and find the most similar known retroviral ORF.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ERVsearch</span> <span class="pre">--target_tasks</span> <span class="pre">Classify</span></code> - run the <em>Screen</em> steps and then sort the sequences into subgroups, build phylogenetic trees for these groups and a summary tree for each gene and genus.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ERVsearch</span> <span class="pre">--target_tasks</span> <span class="pre">ERVRegions</span></code> - run the <em>Screen</em> steps and then find regions with ORFs resembling more than one retroviral gene in close proximity.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ERVsearch</span> <span class="pre">--target_tasks</span> <span class="pre">full</span></code> - run all the above sections.</p></li>
</ul>
<p>You can also run the pipeline up until a specific function - any function name can be provided for the <code class="docutils literal notranslate"><span class="pre">target_tasks</span></code> parameter.</p>
<p>If you only wish to run part of the pipeline, any function name can be provided instead of “full” in the other command, for example to run up until the end of the function <code class="docutils literal notranslate"><span class="pre">classifyWithExonerate</span></code>, use the following command.
<code class="docutils literal notranslate"><span class="pre">ERVsearch</span> <span class="pre">--target_tasks</span> <span class="pre">classifyWithExonerate</span></code> All functions prior to this function will run if needed.</p>
</div>
<div class="section" id="parallelisation">
<h3>Parallelisation<a class="headerlink" href="#parallelisation" title="Permalink to this headline">¶</a></h3>
<p>The pipeline is paralellised to run jobs simultaneously where possible. To do this, set the parameter<code class="docutils literal notranslate"><span class="pre">--jobs</span> <span class="pre">N</span></code> in the command line, where N is the number of CPUs available on your machine.
e.g.
<code class="docutils literal notranslate"><span class="pre">ERVsearch</span> <span class="pre">--target_tasks</span> <span class="pre">full</span> <span class="pre">--jobs</span> <span class="pre">8</span></code>
would run on 8 CPUs</p>
<p>If running on a high performance cluster, it is recommended to use a single node and set <code class="docutils literal notranslate"><span class="pre">--jobs</span></code> to the number of cores available on that node.</p>
<p>###Verbosity
Ruffus verbosity is set using the <code class="docutils literal notranslate"><span class="pre">-v</span></code> parameter from 0 to 10. The recommended setting is -v 5.</p>
<p>e.g.
<code class="docutils literal notranslate"><span class="pre">ERVsearch</span> <span class="pre">--target_tasks</span> <span class="pre">full</span> <span class="pre">-v</span> <span class="pre">5</span></code></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="parameters.html" class="btn btn-neutral float-right" title="Parameters" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../index.html" class="btn btn-neutral float-left" title="ERVsearch Documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Katy Brown

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>